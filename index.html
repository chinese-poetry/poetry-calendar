<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>诗词日历</title>
        <meta name="author"  content="JackeyGao">
        <meta name="description" content="JackeyGao, 一个程序员的技术分享和对生活的理解.">
        <meta name="keywords"  content="JackeyGao, JackeyGao的日记本, Python, Django, Vue.js, chinese-poetry">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="assets/global.css">
        <link rel="stylesheet" href="assets/theme.css">
        <link rel="stylesheet" href="assets/semantic/components/site.min.css">
        <link rel="stylesheet" href="assets/semantic/components/grid.min.css">
        <link rel="stylesheet" href="assets/semantic/components/menu.min.css">
        
        <link rel="apple-touch-icon" sizes="57x57" href="assets/images/favicons/apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="assets/images/favicons/apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="assets/images/favicons/apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="assets/images/favicons/apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="assets/images/favicons/apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="assets/images/favicons/apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="assets/images/favicons/apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="assets/images/favicons/apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicons/apple-icon-180x180.png">
        <link rel="icon" type="image/png" sizes="192x192"  href="assets/images/favicons/android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicons/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="assets/images/favicons/favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicons/favicon-16x16.png">
        <link rel="manifest" href="assets/images/favicons/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="assets/images/favicons/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">
    </head>
    
    <body>
        <div id="main" >
            <div class="container">
            <div id="grid" class="ui stackable two column grid">
                <div class="zuo column" style="background: rgba(255, 255, 255, 0.6);">
                    <div id="imageCover" class="cover">
                        <div class="intro">
                            <div class="inner">
                                <div class="left" style="display: inline-block;" onclick="last()">
                                    ←
                                </div>
                                <div class="middle">来自: <a id="imageLink" href="https://jackeygao.io" target="blank">JackeyGao</a></div>
                                
                                <div class="right" style="display: inline-block;" onclick="next()">
                                     →
                                </div>
                        </div>
                        </div>
                        
                    </div>
                </div>
                <div class="you column">
                    <div class="you-wrapper" style="background: rgba(255, 255, 255, 0.6);">

                    <div class="ui top only-screen equal width top grid">
                        <div class="l ten wide column">
                            <div id="todaySolar" class="yang">2018.11.30 周五</div>
                            <div id="firstSolar" class="yang">2018.11.30</div>
                        </div>
                        <div class="r column">
                            <div onclick="today()" id="todayLunar" class="today">十月廿三</div>
                            <div onclick="today()" id="firstLunar" class="today">十月廿三</div> ~
                        </div>
                    </div>

                    <div class="middle">
                        <div class="ui top equal width grid meta">
                            <div class="l ten wide column">
                                <div id="ptitle" class="title">虞美人</div>
                            </div>
                            <div class="r column">
                                <div id="pauthor" class="author">李煜</div>
                            </div>
                        </div>
                        <div id="pcontent-wrapper">
                            <div id="pcontent" class="poetry-content uu">
                                <p>春花秋月何时了，往事知多少？</p>
                 
                                <p>小楼昨夜又东风，故国不堪回首月明中。</p>
                 
                                <p>雕栏玉砌应犹在，只是朱颜改。</p>
                 
                                <p>问君能有几多愁？恰似一江春水向东流。</p>
                            </div>
                        </div>
                    </div>

                    <div class="calendar">
                        <div class="ui text seven item menu">
                            <div id="w1" data-date="2018-08-01" class="item">
                                <div>
                                    <div class="yang">26</div>
                                    <div class="yin">十九</div>
                                </div>
                            </div>
                            <div id="w2" class="item">
                                <div>
                                    <div class="yang">26</div>
                                    <div class="yin">十九</div>
                                </div>
                            </div>
                            <div id="w3" class="item">
                                <div>
                                    <div class="yang header">26</div>
                                    <div class="yin">十九</div>
                                </div>
                            </div>
                            <div id="w4" class="item">
                                <div>
                                    <div class="yang header">26</div>
                                    <div class="yin">十九</div>
                                </div>
                            </div>
                            <div id="w5" class="item">
                                <div>
                                    <div class="yang header">27</div>
                                    <div class="yin">二十</div>
                                </div>
                            </div>
                            <div id="w6" class="item">
                                <div>
                                    <div class="yang header">28</div>
                                    <div class="yin">廿一</div>
                                </div>
                            </div>
                            <div id="w7" class="item">
                                <div>
                                    <div class="yang header">29</div>
                                    <div class="yin">廿二</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>

                    <div class="footer">
                        © <a href="https://jackeygao.io">JackeyGao.io</a> 2018. 
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script src="assets/js/calendar.js"></script>
    <script src="assets/js/web.js"></script>
    <script src="assets/js/节日表.js"></script>
    <script src="assets/js/诗词表.js"></script>
    <script src="assets/js/images.js"></script>
    <script src="assets/js/tang300.js"></script>

    <script>
        var wrappers = ["site-wrapper", "social-links-wrapper", "donation-wrapper", "skin-wrapper"]
        function render(t) {
            window.day = t;
            var ji = getJijie(t)
            var jijieFlower = JIJIEMAP[ji]
            console.log(ji, jijieFlower)
            // 季节花
            document.getElementById("grid").style.backgroundImage = "url('assets/images/" + jijieFlower + ".png')";

            var currentWeekNumber = weekNumber(t);
            var currentMonday = monDay(t);
            var currentWeeks = weekDays(currentMonday);

            var day = calendar.solar2lunar(t.getFullYear(), t.getMonth() + 1, t.getDate());

            var lunarDate = day.gzYear + '·' + day.IMonthCn + day.IDayCn;
            var solarDate = day.cYear + '.' + day.cMonth + '.' + day.cDay + '   ' + day.ncWeek;

            document.getElementById("todayLunar").innerHTML = lunarDate
            document.getElementById("todaySolar").innerHTML = solarDate

            // images
            var image = images[Math.floor(Math.random() * images.length)];
            document.getElementById("imageCover").style.backgroundImage = "url('images/" + image.src + "')";
            document.getElementById("imageLink").href = image.link;
            document.getElementById("imageLink").innerHTML = image.author;

            // Poetry
            var poetry = weekPoetry[currentWeekNumber[1] - 1]

            if (!poetry) {
                var poetry = poetrys[Math.floor(Math.random() * poetrys.length)];
                poetry.content = poetry.paragraphs
            }

            if (poetry.dynasty) {
                var author = poetry.dynasty + '·' + poetry.author;
            } else {
                var author = poetry.author;
            }

            setContentP(poetry.content)
            document.getElementById("ptitle").innerHTML = poetry.title
            document.getElementById("pauthor").innerHTML = author

            var weekIds = ["w1", "w2", "w3", "w4", "w5", "w6", "w7"]
            var firstSolar = ""
            var firstLunar = ""


            for (var i in weekIds) {
                var id = weekIds[i];
                var solar = currentWeeks[i];
                var lunar = calendar.solar2lunar(
                    solar.getFullYear(), 
                    solar.getMonth() + 1, 
                    solar.getDate()
                );


                if (id === 'w1') {
                    firstSolar = firstSolar + pad(lunar.cMonth) + '.' + pad(lunar.cDay) + ''
                    firstLunar = firstLunar + pad(lunar.IMonthCn) + pad(lunar.IDayCn);
                }


                if (id === 'w7') {
                    titleSolar = lunar.cYear + '-' + '第' + pad(currentWeekNumber[1]) + '周';
                    firstSolar = firstSolar + '~' + pad(lunar.cMonth) + '.' + pad(lunar.cDay) + ''
                    firstLunar = firstLunar + '~' + pad(lunar.IMonthCn) + pad(lunar.IDayCn);
                    document.getElementById("firstSolar").innerHTML = firstSolar
                    document.getElementById("firstLunar").innerHTML = firstLunar

                    document.title = '诗词周历-' + titleSolar + '-' + firstSolar;
                }

                var el = document.getElementById(id);

                if (solar.getDate() === t.getDate()) {
                    el.classList.add("active");
                    if (lunar.lMonth === 4 && lunar.lDay === 26) {
                        document.getElementById("pcontent").innerHTML = "祝你生日快乐，\n祝你生日快乐，\n祝你生日快乐，\n祝你生日快乐~~"
                        document.getElementById("ptitle").innerHTML = "生日歌"
                        document.getElementById("pauthor").innerHTML = "党中央"
                    }
                } else {
                    el.classList.remove("active")
                }

                el.getElementsByClassName("yang")[0].innerHTML = lunar.cDay

                var lunarElement = el.getElementsByClassName("yin")[0]

                var nextDay = new Date(solar.getFullYear(),  solar.getMonth(), solar.getDate())
                nextDay.setDate(solar.getDate() + 1);
            
                var nextDay = calendar.solar2lunar(
                    nextDay.getFullYear(), 
                    nextDay.getMonth() + 1, 
                    nextDay.getDate()
                );

                if (nextDay.IMonthCn + nextDay.IDayCn === '正月初一') {
                    lunarElement.innerHTML = '除夕'
                    continue
                }

                if (nextDay.Term === '清明') {
                    lunarElement.innerHTML = '寒食'
                    continue
                }

                if (lunar.IMonthCn + lunar.IDayCn in lundarDayMap) {
                    lunarElement.innerHTML = lundarDayMap[lunar.IMonthCn + lunar.IDayCn]
                    continue
                }

                if (lunar.cMonth + '.' + lunar.cDay in solarDayMap) {
                    lunarElement.innerHTML = solarDayMap[lunar.cMonth + '.' + lunar.cDay]
                    continue
                }

                if (lunar.Term) {
                    lunarElement.innerHTML = lunar.Term
                } else {
                    lunarElement.innerHTML = lunar.IDayCn
                }

            }
        }

        // render(new Date());
        var url = new URL(window.location.href);
        var d = url.searchParams.get("d");
        var renderDate = new Date(d);
        if (d !== null) {
            render(renderDate)
        } else {
            render(new Date()) 
        }
    </script>
</html>
